<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>TFY ê¸€</title>

  <!-- ê¸°ì¡´ ìŠ¤íƒ€ì¼ ìœ ì§€ -->
  <link rel="stylesheet" href="assets/css/base.css" />
  <link rel="stylesheet" href="assets/css/post.css" />
  <!-- âœ… ë ˆì´ì•„ì›ƒ ê¹¨ì§ ë°©ì§€ ì „ìš©(ì¶”ê°€) -->
  <link rel="stylesheet" href="assets/css/post-fix.css" />
</head>
<body>
  <!-- TOPBAR (ê¸°ì¡´ ìœ ì§€) -->
  <div class="topbar">
    <div class="topbar-inner">
      <div class="brand" onclick="location.href='index.html'" style="cursor:pointer;">
        <span class="logo">TFY</span>
        <span class="brand-name">TFY</span>
      </div>
      <nav class="nav">
        <a class="nav-link" href="index.html">í™ˆ</a>
      </nav>
    </div>
  </div>

  <main class="page">
    <div class="grid">
      <!-- LEFT: Post -->
      <section class="left">
        <article class="card tfx-post-shell">
          <h1 id="postTitle" class="tfx-post-title">ê¸€ì„ ì—¬ëŠ” ì¤‘ì…ë‹ˆë‹¤â€¦</h1>
          <div id="postMeta" class="tfx-post-meta">ì ì‹œë§Œ ê¸°ë‹¤ë ¤ ì£¼ì„¸ìš”.</div>

          <!-- âœ… JSê°€ ì—¬ê¸°ë¡œ ê¸€ ë‚´ìš©ì„ ê½‚ìŠµë‹ˆë‹¤ -->
          <div id="postContent" class="tfx-post-content">
            <div style="font-weight:900; font-size:16px; margin-bottom:6px;">ê¸€ì„ ì—¬ëŠ” ì¤‘ì…ë‹ˆë‹¤â€¦</div>
            <div style="color:#6B7280;">ì ì‹œë§Œ ê¸°ë‹¤ë ¤ ì£¼ì„¸ìš”.</div>
          </div>
        </article>
      </section>

      <!-- RIGHT: Sidebar (âœ… ì—¬ê¸°ë¡œ ì¿ í° íŒ¨ë„ì„ â€œì´ë™â€ì‹œí‚µë‹ˆë‹¤) -->
      <aside class="right">
        <div id="rightSlot">
          <!-- ê¸°ë³¸ placeholder (ì¿ í° íŒ¨ë„ì„ ëª» ì°¾ì•˜ì„ ë•Œë§Œ ë³´ì—¬ì¤Œ) -->
          <div class="card coupon-panel">
            <div class="coupon-head">
              <div class="coupon-title">ğŸ”¥ ì¿ í° ì½”ë“œ Â· ë§í¬</div>
              <div class="coupon-desc">í´ë¦­ â†’ ì½”ë“œë³µì‚¬ â†’ ì´ë™ ìˆœì„œë¡œ ì§„í–‰í•˜ì„¸ìš”.</div>
            </div>
            <div style="color:#6B7280; font-size:13px;">í‘œì‹œí•  ì¿ í°ì´ ì—†ìŠµë‹ˆë‹¤.</div>
          </div>
        </div>
      </aside>
    </div>
  </main>

  <script>
    (async function () {
      const params = new URLSearchParams(location.search);
      const slug = params.get("slug");

      const titleEl = document.getElementById("postTitle");
      const metaEl  = document.getElementById("postMeta");
      const contentEl = document.getElementById("postContent");
      const rightSlot = document.getElementById("rightSlot");

      // GitHub Pages ì„œë¸Œí´ë”(/Temu_Free_/) ëŒ€ì‘ìš© basePath
      const basePath = location.pathname.replace(/[^/]*$/, "");

      const moveEmbeddedCouponPanelToSidebar = () => {
        // âœ… ê¸€ ë³¸ë¬¸ ì•ˆì— ìˆëŠ” ì¿ í° íŒ¨ë„ì„ ì°¾ì•„ì„œ ìš°ì¸¡ìœ¼ë¡œ â€œì´ë™â€
        // (ë””ìì¸ ìœ ì§€ í•µì‹¬)
        const embedded = contentEl ? contentEl.querySelector(".coupon-panel") : null;
        if (!embedded) return false;

        // ë³¸ë¬¸ì—ì„œëŠ” ì œê±°ë˜ê³ , ìš°ì¸¡ì— ê·¸ëŒ€ë¡œ ë¶™ìŒ
        embedded.remove();
        if (rightSlot) {
          rightSlot.innerHTML = "";
          rightSlot.appendChild(embedded);
        }
        return true;
      };

      try {
        if (!slug) {
          titleEl.textContent = "ì˜ëª»ëœ ì ‘ê·¼";
          metaEl.textContent = "slug íŒŒë¼ë¯¸í„°ê°€ ì—†ìŠµë‹ˆë‹¤.";
          contentEl.innerHTML = `<div style="color:#E11D48;">URLì´ ì˜¬ë°”ë¥¸ì§€ í™•ì¸í•´ì£¼ì„¸ìš”.</div>`;
          return;
        }

        const postsRes = await fetch(`${basePath}data/posts.json`, { cache: "no-store" });
        if (!postsRes.ok) throw new Error("posts.json fetch failed");
        const postsJson = await postsRes.json();
        const items = Array.isArray(postsJson.items) ? postsJson.items : [];
        const item = items.find((x) => x.slug === slug);

        if (!item) {
          titleEl.textContent = "ê¸€ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤";
          metaEl.textContent = `slug: ${slug}`;
          contentEl.innerHTML = `<div style="color:#E11D48;">posts.jsonì— í•´ë‹¹ slugê°€ ì—†ìŠµë‹ˆë‹¤.</div>`;
          return;
        }

        titleEl.textContent = item.title || "(ì œëª© ì—†ìŒ)";
        metaEl.textContent = `${item.date || ""}${item.hasCoupon ? " Â· ì¿ í° í¬í•¨" : ""} Â· ${item.category || ""}`;

        // posts/<slug>.html ë¡œë“œ
        const htmlRes = await fetch(`${basePath}posts/${slug}.html`, { cache: "no-store" });
        if (!htmlRes.ok) throw new Error(`post html fetch failed: ${htmlRes.status}`);

        const html = await htmlRes.text();
        contentEl.innerHTML = html;

        // âœ… í•µì‹¬: ë³¸ë¬¸ì— ìˆë˜ ì¿ í° íŒ¨ë„ì„ ìš°ì¸¡ ì‚¬ì´ë“œë°”ë¡œ ì´ë™
        moveEmbeddedCouponPanelToSidebar();

      } catch (err) {
        titleEl.textContent = "ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤";
        metaEl.textContent = "ì½˜ì†”(Console)ì—ì„œ ì—ëŸ¬ ë©”ì‹œì§€ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.";
        contentEl.innerHTML = `<div style="color:#E11D48;">${String(err.message || err)}</div>`;
      }
    })();
  </script>
</body>
</html>
